<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <!-- Prevent manual zoom on mobile and keep responsive scaling -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta property="og:title" content="Tashika - Mangas en ligne">
    <meta property="og:description" content="Découvrez et lisez vos mangas préférés en ligne.">
    <meta property="og:image" content="{{ url_for('static', filename='preview.jpg') }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta name="twitter:card" content="summary_large_image">

    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
</head>
<body{% block body_class %}{% endblock %}>
    <header class="main-header">
        <a href="{{ url_for('index') }}" class="site-header" style="text-decoration: none; color: inherit; margin: 10px">
            <h1 class="flaming-title">Yomi-Scan</h1>
        </a>
            <div class="header-actions">
                <div class="dropdown">
                    <button class="menu-toggle-btn" id="header-menu-btn">Menu</button>
                    <div class="dropdown-content" id="header-menu-list">
                        <a href="{{ url_for('index') }}"><i class="fa fa-home"></i> Accueil</a>
                        <a href="{{ url_for('contact') }}"><i class="fas fa-envelope"></i> Contact</a>
                        <a href="{{ url_for('annuaire') }}"><i class="fa fa-th"></i> Annuaire des Manga</a>
                    </div>
                </div>
                <div class="dropdown">
                    <button class="category-toggle-btn" id="header-category-btn">Catégories</button>
                    <div class="dropdown-content" id="header-category-list">
                        {% for category in categories %}
                            <a href="{{ url_for('annuaire', categorie=category) }}">{{ category }}</a>
                        {% endfor %}
                    </div>
                </div>
                <div class="login-links">
                    {% if current_user.is_authenticated %}
                        <a href="{{ url_for('profile') }}" class="nav-link profile-link">
                            <i class="fa fa-user"></i> Mon profil
                        </a>
                        <a href="{{ url_for('logout') }}" class="nav-link logout-link"><i class="fas fa-sign-out-alt" style="color: inherit;"></i> Déconnexion</a>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="nav-link register-link">Inscription</a>
                    {% endif %}
                </div>
    </header>
    <div class="main-content">
        {% block content %}{% endblock %}
        </div>
    <div id="js-notification-area" aria-live="polite" aria-atomic="true"></div>

    <button id="btn-top" title="Remonter en haut" style="position:fixed;bottom:30px;right:30px;z-index:999;display:none;border:none;border-radius:50%;width:48px;height:48px;font-size:2em;box-shadow:0 2px 8px rgba(21, 21, 24, 0.38);cursor:pointer;">
        &#8679;
    </button>

    <script src="{{ url_for('static', filename='search.js') }}" defer></script>
    <script>
document.addEventListener("DOMContentLoaded", function() {
    const flashMessages = document.getElementById("flash-messages");
    if (flashMessages) {
        setTimeout(() => {
            flashMessages.style.display = "none";
        }, 5000);
    }
});
</script>
    <script>
// Fonction pour gérer les favoris dans localStorage
function toggleFavori(mangaName) {
    let favoris = JSON.parse(localStorage.getItem('favoris') || '[]');
    const index = favoris.indexOf(mangaName);
    if (index === -1) {
        favoris.push(mangaName);
    } else {
        favoris.splice(index, 1);
    }
    localStorage.setItem('favoris', JSON.stringify(favoris));
    updateFavoriBtn(mangaName);
}

function isFavori(mangaName) {
    let favoris = JSON.parse(localStorage.getItem('favoris') || '[]');
    return favoris.includes(mangaName);
}

function updateFavoriBtn(mangaName) {
    const btn = document.getElementById('favori-btn');
    if (!btn) return;
    if (isFavori(mangaName)) {
        btn.innerHTML = "★ Retirer des favoris";
        btn.classList.add('favori-active');
    } else {
        btn.innerHTML = "☆ Ajouter aux favoris";
        btn.classList.remove('favori-active');
    }
}

// À appeler au chargement de la page
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById('favori-btn');
    if (btn) {
        const mangaName = btn.dataset.manga;
        updateFavoriBtn(mangaName);
        btn.onclick = function() { toggleFavori(mangaName); };
    }
});
</script>
    <script>
window.addEventListener('scroll', function() {
    document.getElementById('btn-top').style.display = (window.scrollY > 200) ? 'block' : 'none';
});
document.getElementById('btn-top').onclick = function() {
    window.scrollTo({top:0, behavior:'smooth'});
};
</script>
    <script>
document.getElementById('search-input').addEventListener('input', function() {
  fetch('/autocomplete?q=' + encodeURIComponent(this.value))
    .then(r => r.json())
    .then data => {
      // Affiche data.results dans une liste sous le champ
    });
});
</script>
    {% block scripts_extra %}{% endblock %}
    <footer>
        <div class="footer-content-wrapper">
            <div class="footer-content">
                <div class="footer-left">
                    <span class="footer-brand">© 2025 Yomi-Scan. Tous droit reservés</span>
                    <a href="https://facebook.com/Yomi-Scan" target="_blank" class="footer-social" title="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="/contact" class="footer-social" title="Contact">
                        <i class="fas fa-envelope"></i>
                    </a>
                    <a href="https://linkedin.com/Yomi-Scan" target="_blank" class="footer-social" title="LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="https://dribbble.com/Tashika71" target="_blank" class="footer-social" title="Dribbble">
                        <i class="fab fa-dribbble"></i>
                    </a>
                </div>
                <div class="footer-links">
                    <a href="/"><i class="fas fa-home"></i> Accueil</a>
                    <span class="footer-sep">|</span>
                    <a href="/annuaire"><i class="fas fa-th"></i> Annuaire des Manga</a>
                    <span class="footer-sep">|</span>
                    <a href="{{ url_for('derniers_chapitres') }}"><i class="fas fa-list"></i> Derniers chapitres</a>
                </div>
            </div>
        </div>
    </footer>
    <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/static/sw.js');
}
</script>
<script>
if ("Notification" in window && Notification.permission !== "granted") {
  Notification.requestPermission();
}
// Pour déclencher une notif (ex : après ajout d’un chapitre)
function notifyNewChapter(manga, chapter) {
  if (Notification.permission === "granted") {
    new Notification("Nouveau chapitre !", {
      body: manga + " - " + chapter,
      icon: "/static/favicon.png"
    });
  }
}
</script>
{% if new_chapter_added %}
<script>
  notifyNewChapter("{{ manga_name }}", "{{ new_chapter_name }}");
</script>
{% endif %}
</body>
</html>